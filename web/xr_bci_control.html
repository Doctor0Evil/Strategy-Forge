<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>XR BCI Clinical Sampler</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body { font-family: system-ui, sans-serif; background:#050608; color:#f5f5f5; }
    .panel { max-width:640px; margin:32px auto; padding:24px; border-radius:12px;
             background:#151821; box-shadow:0 18px 40px rgba(0,0,0,0.5); }
    h1 { font-size:1.4rem; margin:0 0 8px; }
    .sub { font-size:0.85rem; opacity:0.7; margin-bottom:18px; }
    button { border:0; border-radius:999px; padding:10px 20px; margin-right:8px;
             font-size:0.95rem; cursor:pointer; }
    #start_btn { background:#26c6da; color:#021014; }
    #stop_btn { background:#f44336; color:#fff; }
    button:disabled { opacity:0.4; cursor:default; }
    .metrics { margin-top:18px; font-size:0.9rem; line-height:1.5; }
    .metric-label { opacity:0.7; margin-right:4px; }
    .chip { display:inline-block; padding:2px 8px; border-radius:12px;
            border:1px solid rgba(255,255,255,0.1); margin-right:4px; font-size:0.75rem; }
  </style>
</head>
<body>
  <div class="panel">
    <h1>XR Phone BCI Sampler</h1>
    <div class="sub">
      MT6883 XR handset + Galea‑grade EEG, clinical acquisition, read‑only neuromorphic interface.
    </div>

    <div>
      <button id="start_btn" onclick="startBciSampler()">Start sampling</button>
      <button id="stop_btn" onclick="stopBciSampler()" disabled>Stop</button>
      <span class="chip" id="sampler_state">idle</span>
    </div>

    <div class="metrics">
      <div><span class="metric-label">EEG SNR:</span><span id="eeg_snr">-- dB</span></div>
      <div><span class="metric-label">Artifact rate:</span><span id="artifact_rate">-- %</span></div>
      <div><span class="metric-label">Median latency:</span><span id="latency50">-- ms</span></div>
      <div><span class="metric-label">p99 latency:</span><span id="latency99">-- ms</span></div>
      <div><span class="metric-label">Packet loss:</span><span id="loss">-- %</span></div>
    </div>
  </div>

  <script>
    let samplerActive = false;

    async function startBciSampler() {
      if (samplerActive) return;
      samplerActive = true;
      updateState("starting");
      toggleButtons();

      if (window.xrBciBridge && window.xrBciBridge.startSampling) {
        window.xrBciBridge.startSampling();
      }
    }

    async function stopBciSampler() {
      if (!samplerActive) return;
      samplerActive = false;
      updateState("stopping");
      toggleButtons();

      if (window.xrBciBridge && window.xrBciBridge.stopSampling) {
        window.xrBciBridge.stopSampling();
      }
    }

    function toggleButtons() {
      document.getElementById("start_btn").disabled = samplerActive;
      document.getElementById("stop_btn").disabled = !samplerActive;
    }

    function updateState(state) {
      document.getElementById("sampler_state").textContent = state;
    }

    // Called from Kotlin bridge with JSON metrics
    function onBciSamplerMetricsUpdate(metrics) {
      updateState(metrics.state);
      document.getElementById("eeg_snr").textContent        = metrics.eegSnrDb.toFixed(1) + " dB";
      document.getElementById("artifact_rate").textContent  = metrics.artifactRatePct.toFixed(1) + " %";
      document.getElementById("latency50").textContent      = metrics.medianLatencyMs.toFixed(1) + " ms";
      document.getElementById("latency99").textContent      = metrics.p99LatencyMs.toFixed(1) + " ms";
      document.getElementById("loss").textContent           = metrics.packetLossPct.toFixed(2) + " %";
    }

    window.onBciSamplerMetricsUpdate = onBciSamplerMetricsUpdate;
  </script>
</body>
</html>
